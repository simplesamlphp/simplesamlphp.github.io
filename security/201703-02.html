<aside><div class="sidebar-warning" style="float: right;">
<h2>Date</h2>
March 30, 2017
<h2>Affected versions</h2>
<code>SimpleSAMLphp 1.14.0 - 1.14.11</code>
<h2>Severity</h2>
High
<h2>References</h2>
CVE-2017-12871
</div></aside>

<h1 id="201703-02">201703-02</h1>

<p><strong>Incorrect IV generation for encryption</strong></p>

<h3 id="background">Background</h3>

<p>Block ciphers make use of random, unique values in order to initialize the algorithm when there is a feedback from one
round to the next. Those values are commonly known as <em>Initialization Vectors</em> or <em>IV</em>s. IVs are public (they are
attached to the resulting ciphertext) and therefore they must never be reused, and must be generated by a proper
<em>Cryptographically Secure Pseudo Random Number Generator</em> (CSPRNG) in order to be secure.</p>

<h3 id="description">Description</h3>

<p>An issue with IV generation has been discovered in the <code class="language-plaintext highlighter-rouge">SimpleSAML\Utils\Crypto::_aesEncrypt()</code> method, where the IV
is not generated randomly but based on the first 16 bytes of the SHA256 hash of the secret given as a parameter. This
unfortunate bug has two direct implications:</p>

<ul>
  <li>The security of the secret key is downgraded effectively from 256 bits to 128, given that the first 16 bytes were
made public in the resulting IV.</li>
  <li>The security of the encryption is compromised due to the fact that IVs are reused if the same secret is used twice,
as it happens by default in the <code class="language-plaintext highlighter-rouge">SimpleSAML\Utils\Crypto::aesEncrypt()</code> method, which uses the salt configured as the
secret.</li>
</ul>

<h3 id="affected-versions">Affected versions</h3>

<p>All <strong>SimpleSAMLphp</strong> versions from <strong>1.14.0</strong> to <strong>1.14.11</strong>, both included.</p>

<h3 id="impact">Impact</h3>

<p>The issue described here undermines the security of the encryption offered by the
<code class="language-plaintext highlighter-rouge">SimpleSAML\Utils\Crypto::aesEncrypt()</code> method, and therefore any secrets encrypted with it might be compromised by an
attacker with enough knowledge or resources.</p>

<h3 id="resolution">Resolution</h3>

<p>Upgrade to the <a href="/download">latest version</a>.</p>

<h3 id="credit">Credit</h3>

<p>This security issue was discovered and reported on March 29, 2017 by Chris Czub (Duo Security).</p>
