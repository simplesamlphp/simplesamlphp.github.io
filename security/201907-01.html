<!DOCTYPE html>
<html lang="en">
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Language" content="en">
  <meta name="google-site-verification" content="2S8M18BgYs8cLRL6ClTrfW_xGxfFtMZu2b2jhjrNlss">

  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>SSPSA 201907-01: Reflected Cross-Site-Scripting - SimpleSAMLphp</title>
  <meta name="description" content="SimpleSAMLphp** is an award-winning application written in native PHP that deals with authentication. It implements support for multiple protocols, most notably SAML, OpenID or OAuth.">

  <link rel="stylesheet" href="/res/css/style.css">
  <link rel="stylesheet" href="/res/css/layout.css">
  <link rel="canonical" href="https://simplesamlphp.org/security/201907-01.html">
  <link rel="alternate" type="application/rss+xml" title="SimpleSAMLphp" href="https://simplesamlphp.org/feed.xml">
</head>

  <body>
      <!-- Red logo header -->
  <header>
  <div id="header">
    <div class="right">
      <form style="margin-top: 2.5rem; margin-right: 2rem" method="get" action="https://www.google.com/cse">
        <input type="hidden" name="cx" value="004202914224971217557:8ks4jjstupq" />
        <input type="hidden" name="siteurl" value="www.google.com/cse/home?cx=004202914224971217557:8ks4jjstupq" />
        <input type="hidden" name="adkw" value="AELymgVJ6Sk-kOvUjbxvgShTLwiFlma2evFuVCh0r8q23vn_4eVnkcdnPfbgMvYUTpJpVlb-KkGAKkbn0i-AlWHsVRR9O0J4CNb6cXFkEKRdjXxsC_NlVD4" />
        <input type="search" name="q" placeholder="Search" value="" />
      </form>
    </div>
    <div class="v-center logo-header">
      <div id="logo">
        <a href="https://simplesamlphp.org" style="color: #fff; text-decoration: none">
          <span class="simple">Simple</span>
          <span class="saml">SAML</span>
          <span class="simple">php</span>
        </a>
      </div>
    </div>
    
  </div>

  <!-- Grey header bar below -->
  <nav>
  <div id="headerbar" style="clear: both">
  <p id="breadcrumb"><a href="https://simplesamlphp.org">Home</a> » SSPSA 201907-01: Reflected Cross-Site-Scripting</p>
    <div class="mtoolbar">
      <div class="menuitem first">
        <a href="/download">Download</a>
      </div>
      <div class="menuitem">
        <a href="/docs">Documentation</a>
      </div>
      <div class="menuitem">
        <a href="/security">Security</a>
      </div>
      <div class="menuitem">
        <a href="/modules/">Modules</a>
      </div>
      <div class="menuitem">
        <a href="/translation/">Translation</a>
      </div>
      <div class="menuitem">
        <a href="/developers/">Developers</a>
      </div>
      <div class="menuitem">
        <a href="https://github.com/simplesamlphp/simplesamlphp/projects">Roadmap</a>
      </div>
      <div class="menuitem">
        <a href="/awards">Awards</a>
      </div>
      <div class="menuitem">
        <a href="/users/">Users</a>
      </div>
      <div class="menuitem">
        <a href="/lists/">Mailing lists</a>
      </div>
      <div class="menuitem last">
        <a href="/support/">Support</a>
      </div>
    </div>
    <br style="clear: both; height: 0px; width: 0px" />
  <br style="height: 0px; clear: both" />
  </div><!-- /#headerbar -->
  </nav>
  </header>

  <main>

    <aside><div class="sidebar-warning" style="float: right;">
<h2>Date</h2>
July 10, 2019
<h2>Affected versions</h2>
<code>SimpleSAMLphp &lt; 1.17.3</code><br />
<h2>Severity</h2>
Medium
</div></aside>

<h1 id="201907-01">201907-01</h1>

<p><strong>Reflected Cross-Site-Scripting</strong></p>

<h3 id="background">Background</h3>

<p>SimpleSAMLphp uses metadata to determine how to interact with other SAML entities. This metadata includes what’s called
endpoints, which are URLs belonging to that entity where SAML messages can be sent. These URLs are used directly by
SimpleSAMLphp when a message is sent, either via an HTTP redirection or by automatically posting a form to them.</p>

<h3 id="description">Description</h3>

<p>When sending a SAML message to another entity, SimpleSAMLphp will use the URL of the appropriate endpoint to redirect
the user’s browser to it, or craft a form that will be automatically posted to it, depending on the SAML binding used.
The URL that’s target of the message is fetched from the stored metadata for the given entity, and that metadata is
trusted as correct.</p>

<p>However, if that metadata has been altered by a malicious party (either an attacker or a rogue administrator) to
substitute the URLs of the endpoints with javascript code, SimpleSAMLphp was blindly using them without any validation,
trusting the contents of the metadata. This would lead to a reflected XSS where the javascript code is sent inline to
the web browser, and if SimpleSAMLphp is not using a strict Content Security Policy to forbid inline javascript (which
is the case of the default user interface), then the code will be executed in the end user’s browser.</p>

<h3 id="affected-versions">Affected versions</h3>

<p>All SimpleSAMLphp versions are affected, up to <strong>1.17.2</strong>.</p>

<h3 id="impact">Impact</h3>

<p>If metadata is consumed for a rogue entity that includes javascript code in the corresponding endpoints, this javascript
code might be run by users trying to access this entity.</p>

<p>Even though it’s unlikely that an administrator would add metadata for an entity that contains such endpoints
inadvertently, if metadata is consumed automatically (e.g. using <em>metarefresh</em>) it would be easier to have an scenario
like the one described here if a SAML entity is compromised and its metadata modified.</p>

<p>The severity is assessed as medium given the difficulty to exploit the issue.</p>

<h3 id="resolution">Resolution</h3>

<p>Upgrade to the latest version of SimpleSAMLphp.</p>

<h3 id="credit">Credit</h3>

<p>This security issue was discovered by avlidienbrunn, and reported by Steve Manzuik on July 5, 2019.</p>

    </main>


  </body>
</html>
