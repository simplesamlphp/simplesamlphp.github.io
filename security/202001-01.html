<!DOCTYPE html>
<html lang="en">
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Language" content="en">
  <meta name="google-site-verification" content="2S8M18BgYs8cLRL6ClTrfW_xGxfFtMZu2b2jhjrNlss">

  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>SSPSA 202001-01: Cross-site scripting in error reports - SimpleSAMLphp</title>
  <meta name="description" content="SimpleSAMLphp** is an award-winning application written in native PHP that deals with authentication. It implements support for multiple protocols, most notably SAML, OpenID or OAuth.">

  <link rel="stylesheet" href="/res/css/style.css">
  <link rel="stylesheet" href="/res/css/layout.css">
  <link rel="canonical" href="https://simplesamlphp.org/security/202001-01.html">
  <link rel="alternate" type="application/rss+xml" title="SimpleSAMLphp" href="https://simplesamlphp.org/feed.xml">
</head>

  <body>
      <!-- Red logo header -->
  <header>
  <div id="header">
    <div class="right">
      <form class="searchbox" method="get" action="https://www.google.com/cse">
        <input type="hidden" name="cx" value="004202914224971217557:8ks4jjstupq" />
        <input type="hidden" name="siteurl" value="www.google.com/cse/home?cx=004202914224971217557:8ks4jjstupq" />
        <input type="hidden" name="adkw" value="AELymgVJ6Sk-kOvUjbxvgShTLwiFlma2evFuVCh0r8q23vn_4eVnkcdnPfbgMvYUTpJpVlb-KkGAKkbn0i-AlWHsVRR9O0J4CNb6cXFkEKRdjXxsC_NlVD4" />
        <input type="search" name="q" placeholder="Search" value="" />
      </form>
    </div>
    <div class="v-center logo-header">
      <div id="logo">
        <a href="https://simplesamlphp.org">
          <span class="simple">Simple</span>
          <span class="saml">SAML</span>
          <span class="simple">php</span>
        </a>
      </div>
    </div>
    
  </div>

  <!-- Grey header bar below -->
  <nav>
  <div id="headerbar">
  <p id="breadcrumb"><a href="https://simplesamlphp.org">Home</a> » SSPSA 202001-01: Cross-site scripting in error reports</p>
    <div class="mtoolbar">
      <div class="menuitem first">
        <a href="/download">Download</a>
      </div>
      <div class="menuitem">
        <a href="/docs">Documentation</a>
      </div>
      <div class="menuitem">
        <a href="/security">Security</a>
      </div>
      <div class="menuitem">
        <a href="/modules/">Modules</a>
      </div>
      <div class="menuitem">
        <a href="/support/">Support</a>
      </div>
      <div class="menuitem last">
        <a href="/contrib/">Contribute</a>
      </div>
    </div>
  </div><!-- /#headerbar -->
  </nav>
  </header>

  <main>

    <aside><div class="sidebar-warning right">
<h2>Date</h2>
January 24, 2020
<h2>Affected versions</h2>
<code>SimpleSAMLphp 1.18.0 - 1.18.3</code><br />
<h2>Severity</h2>
Low
</div></aside>

<h1 id="202001-01">202001-01</h1>

<p><strong>Cross-site scripting in error reports</strong></p>

<h3 id="background">Background</h3>

<p>SimpleSAMLphp allows users to report errors and failures to the system administrators via a web form. This web form
gathers some contextual information automatically, but it also allows the user to provide their email address for
follow-ups and a free-text explanation of what happened. Once submitted, the report is sent as an email to the
administrative email address configured in the software.</p>

<h3 id="description">Description</h3>

<p>The <code class="language-plaintext highlighter-rouge">www/erroreport.php</code> script allows error reports to be submitted and sent to the system administrator. Starting
with SimpleSAMLphp 1.18.0, a new <code class="language-plaintext highlighter-rouge">SimpleSAML\Utils\EMail</code> class was introduced to handle sending emails, implemented as
a wrapper of an external dependency.</p>

<p>This new wrapper allows us to use Twig templates in order to create the email sent with an error report. Since Twig
provides automatic escaping of variables, manual escaping of the free-text field in <code class="language-plaintext highlighter-rouge">www/errorreport.php</code> was removed
to avoid double escaping. However, for those not using the new user interface yet, an email template is hardcoded into
the class itself in plain PHP. Since no escaping is provided in this template, it is then possible to inject HTML
inside the template by manually crafting the contents of the free-text field.</p>

<h3 id="affected-versions">Affected versions</h3>
<p>SimpleSAMLphp versions <strong>1.18.0 to 1.18.3</strong>, both inclusive.</p>

<h3 id="impact">Impact</h3>

<p>An attacker may take advantage of this issue to manually craft a modified email sent via the error reporting mechanism,
such as this email might trick a system administrator into performing an action, such as introducing their credentials
into a phishing web site that resembles the original.</p>

<p>Remote execution of javascript code is considered unfeasible since email clients do not run javascript present in
emails, although there might be email clients which don’t follow this rule, making the attack surface grow.</p>

<h3 id="resolution">Resolution</h3>

<p>Upgrade the SimpleSAMLphp installation to version <strong>1.18.4</strong>.</p>

<h3 id="credit">Credit</h3>

<p>This vulnerability was discovered and reported by Frederic Vleminckx on January 22, 2020.</p>

    </main>


  </body>
</html>
